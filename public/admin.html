<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Admin Menú - Jhoanes Bakery</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f4f1ee; padding: 20px; }
        .product-list-item { background: white; border-radius: 10px; margin-bottom: 10px; padding: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚙️ Gestión del Menú</h1>
        
        <div class="card p-4 mb-4">
            <h5>Agregar Nuevo Producto</h5>
            <div class="row g-2">
                <div class="col-md-3"><input type="text" id="p-nombre" class="form-control" placeholder="Nombre"></div>
                <div class="col-md-2"><input type="number" id="p-precio" class="form-control" placeholder="Precio"></div>
                <div class="col-md-2">
                    <select id="p-cat" class="form-select">
                        <option value="Viennoiserie">Viennoiserie</option>
                        <option value="Postres">Postres</option>
                        <option value="Cafetería">Cafetería</option>
                    </select>
                </div>
                <div class="col-md-3"><input type="text" id="p-img" class="form-control" placeholder="URL Imagen"></div>
                <div class="col-md-2"><button id="guardar-btn" class="btn btn-primary w-100">Guardar</button></div>
            </div>
        </div>

        <div id="lista-gestion-productos"></div>
    </div>

    <script type="module">
        // IMPORTANTE: Usa las llaves { } porque es un export nombrado
        import { firebaseConfig } from './config.js'; 

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Inicializa con la variable importada
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Función para guardar producto
        const guardarProducto = async () => {
            const nombre = document.getElementById('p-nombre').value;
            const precio = parseFloat(document.getElementById('p-precio').value);
            const categoria = document.getElementById('p-cat').value;
            const imagen = document.getElementById('p-img').value;

            await addDoc(collection(db, "productos"), { nombre, precio, categoria, imagen });
            alert("Producto añadido");
        };

        // Función para eliminar producto
        window.eliminarP = async (id) => { 
            if(confirm("¿Borrar?")) await deleteDoc(doc(db, "productos", id)); 
        };

        // Mostrar productos para editar/borrar
        onSnapshot(collection(db, "productos"), (snapshot) => {
            const lista = document.getElementById('lista-gestion-productos');
            lista.innerHTML = "";
            snapshot.forEach(docSnap => {
                const p = docSnap.data();
                lista.innerHTML += `
                    <div class="product-list-item d-flex justify-content-between align-items-center shadow-sm">
                        <div>
                            <strong>${p.nombre}</strong> - $${p.precio} <span class="badge bg-secondary">${p.categoria}</span>
                        </div>
                        <div>
                            <button class="btn btn-danger btn-sm" onclick="eliminarP('${docSnap.id}')">Eliminar</button>
                        </div>
                    </div>`;
            });
        });

        // Agregar event listener al botón Guardar
        document.getElementById('guardar-btn').addEventListener('click', guardarProducto);
    </script>
</body>
</html>