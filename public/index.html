<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jhoanes Bakery - Men√∫</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --cafe: #3d2b1f; --dorado: #d4a373; --crema: #fcf9f5; }
        body { background-color: var(--crema); font-family: 'Segoe UI', sans-serif; }
        .header-bakery { background: var(--cafe); color: white; padding: 40px 0; text-align: center; border-bottom: 5px solid var(--dorado); }
        .product-card { border: none; border-radius: 15px; transition: 0.3s; background: white; height: 100%; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn-add { background: var(--dorado); color: white; border: none; font-weight: bold; }
        .btn-add:hover { background: #bc8a5f; color: white; }
        .cart-btn { position: fixed; bottom: 20px; right: 20px; padding: 15px 30px; font-size: 1.2rem; z-index: 1000; }
        .category-header { color: var(--cafe); border-left: 5px solid var(--dorado); padding-left: 15px; margin: 30px 0 20px; }
    </style>
</head>
<body>

<div class="header-bakery">
    <h1>ü•ê Jhoanes Bakery & Coffee</h1>
    <p>Pasteler√≠a Artesanal de Autor</p>
</div>

<div class="container mb-5 mt-4">
    <div id="menu-container"></div>
</div>

<button class="btn btn-dark rounded-pill shadow-lg cart-btn" data-bs-toggle="modal" data-bs-target="#cartModal">
    üõí Carrito <span id="cart-count" class="badge bg-danger">0</span>
</button>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Pedido</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tu Nombre:</label>
                    <input type="text" id="clienteNombre" class="form-control" placeholder="Ej: Juan P√©rez">
                </div>
                <hr>
                <ul id="cart-items" class="list-group list-group-flush mb-3"></ul>
                <h4 class="text-end">Total: <span id="cart-total">$0.00</span></h4>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success w-100 py-3 fw-bold" onclick="confirmarPedido()">üöÄ ENVIAR AL CHEF</button>
            </div>
        </div>
    </div>
</div>

<script type="module">

 // 1. Los imports van PRIMERO y afuera
    import { firebaseConfig } from './config.js'; 
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // 2. Luego inicializas (sin llaves extras)
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    //------------------------


    const productos = [
        { cat: "Viennoiserie", nombre: "Artisanal Croissant", precio: 2.50, icon: "ü•ê" },
        { cat: "Viennoiserie", nombre: "Almond Croissant", precio: 3.50, icon: "ü•ê" },
        { cat: "Postres", nombre: "Emerald Temptation", precio: 6.50, icon: "üü¢" },
        { cat: "Postres", nombre: "Mango Coco Dream", precio: 7.00, icon: "ü•≠" }
    ];

    let carrito = [];

    // Renderizar Men√∫
    const menuContainer = document.getElementById('menu-container');
    const cats = [...new Set(productos.map(p => p.cat))];
    
    cats.forEach(cat => {
        let html = `<h3 class="category-header">${cat}</h3><div class="row">`;
        productos.filter(p => p.cat === cat).forEach(p => {
            html += `
                <div class="col-6 col-md-4 col-lg-3 mb-4">
                    <div class="card product-card p-3 shadow-sm text-center">
                        <div style="font-size: 3rem">${p.icon}</div>
                        <h6 class="mt-2">${p.nombre}</h6>
                        <p class="text-success fw-bold">$${p.precio.toFixed(2)}</p>
                        <button class="btn btn-add btn-sm w-100" onclick="agregarAlCarrito('${p.nombre}', ${p.precio})">Agregar</button>
                    </div>
                </div>`;
        });
        html += `</div>`;
        menuContainer.innerHTML += html;
    });

    window.agregarAlCarrito = (nombre, precio) => {
        carrito.push({ nombre, precio });
        document.getElementById('cart-count').innerText = carrito.length;
        actualizarModal();
    };

    function actualizarModal() {
        const list = document.getElementById('cart-items');
        let total = 0;
        list.innerHTML = carrito.map(item => {
            total += item.precio;
            return `<li class="list-group-item d-flex justify-content-between small">${item.nombre} <span>$${item.precio.toFixed(2)}</span></li>`;
        }).join('');
        document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
    }

    window.confirmarPedido = async () => {

        const nombre = document.getElementById('clienteNombre').value;
       
        if (!nombre || carrito.length === 0) return alert("Por favor ingresa tu nombre y a√±ade productos");

        try {
            await addDoc(collection(db, "pedidos"), {
                cliente: nombre,
                items: carrito,
                total: carrito.reduce((sum, item) => sum + item.precio, 0),
                estado: "Pendiente",
                fecha: serverTimestamp()
            });
            alert("¬°Pedido enviado con √©xito!");
            carrito = [];
            document.getElementById('clienteNombre').value = "";
            document.getElementById('cart-count').innerText = "0";
            location.reload(); 
        } catch (e) {
            console.error("Error al enviar:", e);
            alert("Error al conectar con la base de datos.");


console.log("¬°Bot√≥n presionado!"); // <--- AGREGA ESTO
    
    const nombre = document.getElementById('clienteNombre').value;
    console.log("Nombre detectado:", nombre); // <--- Y ESTO

            
        }
    };
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>